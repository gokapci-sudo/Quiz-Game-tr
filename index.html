<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz Master - Daily Challenge</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { margin: 0; background: #0f172a; color: white; font-family: sans-serif; overflow-y: auto; }
        #game-container { padding: 20px; text-align: center; max-width: 500px; margin: auto; }
        #timer { font-size: 2rem; color: #38bdf8; font-weight: bold; margin: 10px 0; }
        #question-box { background: #1e293b; padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 2px solid #334155; font-size: 1.2rem; }
        .option { 
            display: block; width: 100%; padding: 15px; margin: 8px 0; 
            background: #334155; border: none; border-radius: 10px; 
            color: white; font-size: 1rem; cursor: pointer;
        }
        /* ƒ∞nceleme Ekranƒ± Stilleri */
        .review-item { text-align: left; background: #1e293b; padding: 15px; margin: 10px 0; border-radius: 10px; font-size: 0.9rem; }
        .correct { color: #4ade80; font-weight: bold; }
        .wrong { color: #f87171; font-weight: bold; }
        #leaderboard-btn {
            display: none; width: 100%; padding: 15px; background: #38bdf8; color: #0f172a; 
            border: none; border-radius: 10px; font-weight: bold; margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="header">G√ºn√ºn Sorularƒ± (00:00'da Yenilenir)</div>
        <div id="timer">0.00s</div>
        <div id="question-box">Y√ºkleniyor...</div>
        <div id="options-container"></div>
        <div id="review-container"></div>
        <button id="leaderboard-btn" onclick="showLeaderboard()">üèÜ Lƒ∞DERLƒ∞K TABLOSU</button>
    </div>

    <script>
        const SB_URL = 'https://arumdxephyjteoypjaxh.supabase.co';
        const SB_KEY = 'sb_publishable_qEEOLIXhKlkLM_poqDDkhw_OkNS_yo1';
        const tg = window.Telegram.WebApp; tg.expand();
        const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

        // --- B√úY√úK SORU HAVUZU ---
        const questionPool = [
            { q: "D√ºnyanƒ±n en y√ºksek daƒüƒ± hangisidir?", a: ["K2", "Everest", "Lhotse"], c: 1 },
            { q: "Hangi elementin simgesi 'Au'dur?", a: ["G√ºm√º≈ü", "Bakƒ±r", "Altƒ±n"], c: 2 },
            { q: "Aspirin'in hammaddesi nedir?", a: ["Me≈üe", "S√∂ƒü√ºt", "√áam"], c: 1 },
            { q: "ƒ∞lk Nobel √∂d√ºl√º hangi yƒ±lda verilmi≈ütir?", a: ["1901", "1915", "1923"], c: 0 },
            { q: "Hangi √ºlke en √ßok adaya sahiptir?", a: ["Yunanistan", "Endonezya", "ƒ∞sve√ß"], c: 2 },
            { q: "ƒ∞nsan v√ºcudundaki en sert doku hangisidir?", a: ["Kemik", "Di≈ü Minesi", "Kƒ±kƒ±rdak"], c: 1 },
            { q: "G√ºne≈ü'e en yakƒ±n gezegen?", a: ["Merk√ºr", "Ven√ºs", "D√ºnya"], c: 0 },
            { q: "Telefonu kim icat etti?", a: ["Edison", "Graham Bell", "Tesla"], c: 1 },
            { q: "Fransa'nƒ±n ba≈ükenti?", a: ["Lyon", "Marsilya", "Paris"], c: 2 },
            { q: "8x8 satran√ß tahtasƒ±nda ka√ß kare vardƒ±r?", a: ["32", "64", "128"], c: 1 },
            { q: "T√ºrkiye'nin en b√ºy√ºk g√∂l√º?", a: ["Van G√∂l√º", "Tuz G√∂l√º", "Eƒüirdir"], c: 0 },
            { q: "Kendi ƒ±≈üƒ±ƒüƒ±nƒ± √ºreten g√∂k cismi?", a: ["Gezegen", "Yƒ±ldƒ±z", "Uydu"], c: 1 },
            { q: "Hangisi bir memelidir?", a: ["Balina", "K√∂pekbalƒ±ƒüƒ±", "Timsah"], c: 0 },
            { q: "Avrupa Birliƒüi'nin merkezi neresidir?", a: ["Paris", "Berlin", "Br√ºksel"], c: 2 },
            { q: "DNA'nƒ±n yapƒ±sƒ± nasƒ±ldƒ±r?", a: ["Tekli Sarmal", "√áift Sarmal", "Daire"], c: 1 }
            // Buraya y√ºzlerce soru ekleyebilirsin...
        ];

        let dailyQuestions = [];
        let userAnswers = [];
        let currentIdx = 0, startTime, timerInterval, penaltyTime = 0;

        // --- G√úNL√úK SORU SE√áƒ∞Cƒ∞ (00:00 AYARI) ---
        function getDailyQuestions() {
            const today = new Date().toLocaleDateString('tr-TR'); // G√ºn-Ay-Yƒ±l formatƒ±
            let seed = today.split('.').join(''); // "26012026" gibi bir sayƒ± olu≈üturur
            let randomSeed = parseInt(seed);
            
            // Basit bir karƒ±≈ütƒ±rma algoritmasƒ± (Her g√ºn aynƒ± sƒ±rayƒ± verir)
            let shuffled = [...questionPool].sort(() => {
                randomSeed = (randomSeed * 9301 + 49297) % 233280;
                return (randomSeed / 233280) - 0.5;
            });
            return shuffled.slice(0, 10);
        }

        function init() {
            dailyQuestions = getDailyQuestions();
            document.getElementById('question-box').innerText = "G√ºn√ºn 10 sorusuna hazƒ±r mƒ±sƒ±n?";
            document.getElementById('options-container').innerHTML = `<button class="option" onclick="startGame()">YARI≈ûMAYI BA≈ûLAT</button>`;
        }

        function startGame() {
            currentIdx = 0; userAnswers = []; penaltyTime = 0;
            startTime = Date.now();
            timerInterval = setInterval(() => {
                let now = ((Date.now() - startTime) / 1000 + penaltyTime).toFixed(2);
                document.getElementById('timer').innerText = now + "s";
            }, 50);
            renderQuestion();
        }

        function renderQuestion() {
            if (currentIdx >= dailyQuestions.length) return endGame();
            let qData = dailyQuestions[currentIdx];
            document.getElementById('question-box').innerText = `${currentIdx + 1}. ${qData.q}`;
            let container = document.getElementById('options-container');
            container.innerHTML = "";
            qData.a.forEach((opt, i) => {
                let btn = document.createElement('button');
                btn.className = "option";
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(i);
                container.appendChild(btn);
            });
        }

        function handleAnswer(choice) {
            let qData = dailyQuestions[currentIdx];
            userAnswers.push(choice);
            if (choice !== qData.c) {
                penaltyTime += 5; // Yanlƒ±≈ü cevaba 5 sn ceza
                tg.HapticFeedback.notificationOccurred('error');
            } else {
                tg.HapticFeedback.notificationOccurred('success');
            }
            currentIdx++;
            renderQuestion();
        }

        function endGame() {
            clearInterval(timerInterval);
            let finalTime = ((Date.now() - startTime) / 1000 + penaltyTime).toFixed(2);
            document.getElementById('timer').innerText = finalTime + "s";
            document.getElementById('question-box').innerText = "YARI≈ûMA TAMAMLANDI!";
            document.getElementById('options-container').innerHTML = "";
            
            // SONU√áLARI G√ñSTER (ƒ∞nceleme Ekranƒ±)
            let reviewHtml = "<h3> Yanƒ±t Analizi:</h3>";
            dailyQuestions.forEach((q, i) => {
                let uAns = userAnswers[i];
                let isCorrect = uAns === q.c;
                reviewHtml += `
                    <div class="review-item">
                        <strong>Soru ${i+1}:</strong> ${q.q}<br>
                        <span class="${isCorrect ? 'correct' : 'wrong'}">Senin Cevabƒ±n: ${q.a[uAns]}</span><br>
                        ${!isCorrect ? `<span class="correct">Doƒüru Cevap: ${q.a[q.c]}</span>` : ''}
                    </div>`;
            });
            document.getElementById('review-container').innerHTML = reviewHtml;
            saveScore(finalTime);
        }

        async function saveScore(f) {
            const u = tg.initDataUnsafe?.user;
            const data = { 
                telegram_id: u?.id || Math.floor(Math.random()*999), 
                username: u?.first_name || "Bilgin", 
                score: parseFloat(f) 
            };
            await _supabase.from('leaderboard').insert([data]);
            document.getElementById('leaderboard-btn').style.display = 'block';
            tg.showAlert(`Bƒ∞TTƒ∞! Toplam S√ºren (Cezalar Dahil): ${f}s`);
        }

        async function showLeaderboard() {
            const { data } = await _supabase.from('leaderboard').select('*').order('score', { ascending: true }).limit(5);
            if (data) {
                let list = data.map((item, i) => `${i+1}. ${item.username}: ${item.score}s`).join('\n');
                tg.showConfirm("üèÜ G√úN√úN EN HIZLILARI:\n\n" + list);
            }
        }

        init();
    </script>
</body>
</html>
