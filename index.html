<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Skill Survive - Oyun</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        canvas { display: block; margin: 0 auto; }
        #ui-layer {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            color: white;
            font-family: sans-serif;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="ui-layer">
        <h2 id="status">HAZIR OL!</h2>
        <p id="info">Ekrana Basılı Tutarak Koş</p>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            backgroundColor: '#222',
            parent: 'phaser-example',
            scene: { preload: preload, create: create, update: update }
        };

        const game = new Phaser.Game(config);
        let player;
        let isMoving = false;
        let gameStatus = 'WAITING'; // WAITING, GREEN, RED, ELIMINATED, WIN
        let finishLine = 100;
        let lightTimer;

        function preload() {
            // Şimdilik basit şekiller kullanacağız, ilerde görsel ekleriz
        }

        function create() {
            const centerX = config.width / 2;
            
            // Bitiş Çizgisi
            this.add.rectangle(centerX, finishLine, config.width, 10, 0x00ff00);
            
            // Oyuncu (Kırmızı bir kare)
            player = this.add.rectangle(centerX, config.height - 100, 40, 40, 0xff0055);
            
            // Giriş Kontrolleri
            this.input.on('pointerdown', () => { if(gameStatus !== 'ELIMINATED') isMoving = true; });
            this.input.on('pointerup', () => { isMoving = false; });

            // Oyun Döngüsünü Başlat
            startLightCycle();
        }

        function startLightCycle() {
            let nextState = (gameStatus === 'GREEN') ? 'RED' : 'GREEN';
            gameStatus = nextState;
            
            document.getElementById('status').innerText = (gameStatus === 'GREEN') ? "YEŞİL IŞIK - KOŞ!" : "KIRMIZI IŞIK - DUR!";
            document.getElementById('status').style.color = (gameStatus === 'GREEN') ? "#00ff00" : "#ff0000";

            if (gameStatus === 'RED') tg.HapticFeedback.notificationOccurred('warning');

            // Rastgele sürelerde ışık değiştir (2-4 saniye arası)
            let duration = Math.random() * 2000 + 1500;
            setTimeout(startLightCycle, duration);
        }

        function update() {
            if (gameStatus === 'ELIMINATED' || gameStatus === 'WIN') return;

            if (isMoving) {
                player.y -= 2; // Oyuncuyu yukarı hareket ettir

                // KIRMIZI IŞIKTA HAREKET KONTROLÜ (BECERİ KAYBI)
                if (gameStatus === 'RED') {
                    gameStatus = 'ELIMINATED';
                    document.getElementById('status').innerText = "ELENDİN!";
                    tg.HapticFeedback.notificationOccurred('error');
                    player.setFillStyle(0x555555); // Karakteri gri yap (öldü)
                }
            }

            // KAZANMA KONTROLÜ
            if (player.y <= finishLine) {
                gameStatus = 'WIN';
                document.getElementById('status').innerText = "TEBRİKLER! KAZANDIN!";
                tg.HapticFeedback.notificationOccurred('success');
            }
        }
    </script>
</body>
</html>
