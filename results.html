<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <header style="display: flex; align-items: center; margin-bottom: 20px;">
            <button onclick="location.href='dashboard.html'" class="btn-sub" style="width: auto; padding: 0 15px;">â¬…</button>
            <h2 style="margin-left: 15px;">ðŸŽ‰SON ÅžAMPÄ°YONLARðŸŽ‰</h2>
        </header>

        <div class="card" style="padding: 0; overflow: hidden;">
            <table>
                <thead>
                    <tr style="background: #242f3d;">
                        <th>#</th>
                        <th>YARIÅžMACI</th>
                        <th>PUAN</th>
                        <th>SÃœRE</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        async function load() {
            try {
                // results tablosundan verileri Ã§ekiyoruz
                // Ã–nce puana gÃ¶re (Azalan), sonra sÃ¼reye gÃ¶re (Artan) sÄ±ralÄ±yoruz
                const { data, error } = await supabaseClient
                    .from('results') 
                    .select('username, score, duration')
                    .order('score', { ascending: false })
                    .order('duration', { ascending: true })
                    .limit(50);

                if (error) throw error;

                const body = document.getElementById('leaderboard-body');
                
                if (!data || data.length === 0) {
                    body.innerHTML = `<tr><td colspan="4" style="padding:20px; opacity:0.5;">HenÃ¼z kayÄ±tlÄ± skor yok.</td></tr>`;
                    return;
                }

                body.innerHTML = data.map((u, i) => `
                    <tr>
                        <td>${i === 0 ? 'ðŸ¥‡' : i === 1 ? 'ðŸ¥ˆ' : i === 2 ? 'ðŸ¥‰' : i + 1}</td>
                        <td style="text-align: left; padding-left: 15px;">${u.username || 'Oyuncu'}</td>
                        <td class="yellow-text" style="font-weight: bold;">${u.score}</td>
                        <td style="font-size: 13px; opacity: 0.8;">${u.duration}s</td>
                    </tr>
                `).join('');

            } catch (err) {
                console.error("Liderlik tablosu yÃ¼klenirken hata:", err);
                document.getElementById('leaderboard-body').innerHTML = `<tr><td colspan="4" style="color:red;">YÃ¼kleme hatasÄ±!</td></tr>`;
            }
        }
        
        // Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda yÃ¼kle
        load();
    </script>
</body>
</html>
