<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
</head>
<body>
    <div class="container">
        <div class="card" style="display:flex; justify-content:space-between; align-items:center;"><span id="q-num" class="yellow-text">...</span><div id="timer" style="color:var(--red); font-weight:900; font-size:20px;">15s</div></div>
        <div class="card"><h2 id="q-text" style="min-height:60px;">...</h2><div id="opts" style="display:grid; gap:10px; margin-top:20px;"></div></div>
    </div>
    <script>
        let qs = [], idx = 0, score = 0, t, start = Date.now();
        async function init() {
            const { data } = await supabaseClient.from('questions').select('*').limit(10);
            qs = data; show();
        }
        function show() {
            if(idx >= qs.length) return end();
            const q = qs[idx];
            document.getElementById('q-num').innerText = `SORU: ${idx+1}/10`;
            document.getElementById('q-text').innerText = q.question_text;
            const cont = document.getElementById('opts'); cont.innerHTML = '';
            q.options.forEach((o, i) => {
                const b = document.createElement('button'); b.className = 'btn-sub'; b.innerText = o;
                b.onclick = () => { if(i === q.correct_option) score += 10; idx++; show(); };
                cont.appendChild(b);
            });
            let left = 15; clearInterval(t);
            t = setInterval(() => { 
                left--; document.getElementById('timer').innerText = left+"s";
                if(left <= 0) { idx++; show(); }
            }, 1000);
        }
        async function end() {
            clearInterval(t);
            const time = Math.floor((Date.now() - start) / 1000);
            const user = window.Telegram.WebApp.initDataUnsafe?.user || { id: APP_CONFIG.adminID };
            await supabaseClient.from('profiles').update({ score: score, completion_time: time, has_ticket: false }).eq('telegram_id', user.id);
            document.body.innerHTML = `<div class="container"><div class="card" style="text-align:center; padding:40px;"><h2>BÄ°TTÄ°! ğŸ</h2><p>Puan: ${score} | SÃ¼re: ${time}s</p><button onclick="location.href='dashboard.html'" class="btn-main" style="margin-top:20px;">Tamam</button></div></div>`;
        }
        init();
    </script>
</body>
</html>
