<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css">
    <script src='//libtl.com/sdk.js' data-zone='10527452' data-sdk='show_10527452'></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
</head>
<body>
    <div class="container">
        <button onclick="location.href='dashboard.html'" class="btn-sub" style="width:auto; padding:10px;">â¬… Geri</button>
        <div class="card" style="text-align:center; margin-top:20px;">
            <h2 class="yellow-text">BÄ°LET AL</h2>
        </div>
        <button onclick="watchAd()" class="btn-main">ðŸ“º REKLAM Ä°ZLE (<span id="count">0</span>/5)</button>
        <button onclick="buy()" class="btn-main" style="background:var(--accent); margin-top:10px;">ðŸ’° 1.00 TON Ä°LE AL</button>
    </div>
    <script>
        const tg = window.Telegram.WebApp;
        let c = parseInt(localStorage.getItem('ads')) || 0;
        document.getElementById('count').innerText = c;

        function watchAd() {
            if(typeof show_10527452 !== 'function') return;
            show_10527452('pop').then(() => {
                c++; localStorage.setItem('ads', c);
                document.getElementById('count').innerText = c;
                if(c >= 5) grant();
            });
        }
        async function buy() {
            const user = tg.initDataUnsafe?.user || { id: APP_CONFIG.adminID };
            const { data: p } = await supabaseClient.from('profiles').select('balance').eq('telegram_id', user.id).single();
            if(p.balance >= 1.0) {
                await supabaseClient.from('profiles').update({ balance: p.balance - 1 }).eq('telegram_id', user.id);
                grant();
            } else tg.showAlert("Yetersiz Bakiye!");
        }
        async function grant() {
            const user = tg.initDataUnsafe?.user || { id: APP_CONFIG.adminID };
            await supabaseClient.from('profiles').update({ has_ticket: true }).eq('telegram_id', user.id);
            localStorage.setItem('ads', 0);
            tg.showAlert("Bilet AlÄ±ndÄ±!"); location.href="dashboard.html";
        }
    </script>
</body>
</html>
