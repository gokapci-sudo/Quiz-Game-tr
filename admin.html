<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Quiz Arena</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <header style="margin-bottom: 20px;">
        <button onclick="window.location.href='dashboard.html'" class="btn-sub" style="width: auto; display: inline-block;">â¬… Geri</button>
        <h2 style="display: inline-block; margin-left: 10px;">YÃ¶netim Paneli</h2>
    </header>

    <section class="card">
        <h3>ğŸ’° Ã‡ekim Talepleri</h3>
        <div id="withdrawal-list"><p>YÃ¼kleniyor...</p></div>
    </section>

    <section class="card">
        <h3>ğŸ“¢ Yeni Duyuru</h3>
        <textarea id="ann-content" class="card" style="width:100%; height:80px; background:#0e1621; border-color:#3b4754; color:white;"></textarea>
        <button onclick="addAnn()" class="btn-main">YayÄ±nla</button>
    </section>

    <section class="card">
        <h3>â“ Soru Ekle</h3>
        <input type="text" id="q-text" placeholder="Soru Metni" class="card" style="width:100%; margin-bottom:5px;">
        <input type="text" id="q-opts" placeholder="A,B,C,D (VirgÃ¼lle ayÄ±r)" class="card" style="width:100%; margin-bottom:5px;">
        <input type="number" id="q-correct" placeholder="DoÄŸru Ä°ndeks (0-3)" class="card" style="width:100%; margin-bottom:10px;">
        <button onclick="addQuest()" class="btn-main">Soruyu Kaydet</button>
    </section>

    <script>
        const SB_URL = "https://arumdxephyjteoypjaxh.supabase.co";
        const SB_KEY = "sb_publishable_qEEOLIXhKlkLM_poqDDkhw_OkNS_yo1";
        const supabaseAdmin = supabase.createClient(SB_URL, SB_KEY);

        async function loadRequests() {
            const { data } = await supabaseAdmin.from('withdrawals').select('*').eq('status', 'pending');
            const list = document.getElementById('withdrawal-list');
            list.innerHTML = data?.length ? "" : "Bekleyen talep yok.";
            data?.forEach(req => {
                list.innerHTML += `
                    <div class="req-item" style="border: 1px solid #333; padding: 10px; margin-bottom: 10px;">
                        ID: ${req.telegram_id} <br> Miktar: <span class="yellow-text">${req.amount} TON</span> <br>
                        <button onclick="approve('${req.id}', ${req.telegram_id})" class="btn-main" style="padding:5px; margin-top:5px; font-size:12px; background:#31b545;">Ã–DENDÄ° YAP & SIFIRLA</button>
                    </div>`;
            });
        }

        async function approve(reqId, userId) {
            await supabaseAdmin.from('withdrawals').update({ status: 'paid' }).eq('id', reqId);
            await supabaseAdmin.from('profiles').update({ balance: 0.00 }).eq('telegram_id', userId);
            alert("Ã–deme onaylandÄ± ve kullanÄ±cÄ± bakiyesi sÄ±fÄ±rlandÄ±.");
            loadRequests();
        }

        async function addAnn() {
            const content = document.getElementById('ann-content').value;
            await supabaseAdmin.from('announcements').insert([{ content }]);
            alert("Duyuru yayÄ±nlandÄ±.");
        }

        async function addQuest() {
            const text = document.getElementById('q-text').value;
            const opts = document.getElementById('q-opts').value.split(',');
            const correct = document.getElementById('q-correct').value;
            await supabaseAdmin.from('questions').insert([{ question_text: text, options: opts, correct_option: parseInt(correct) }]);
            alert("Soru eklendi.");
        }

        loadRequests();
    </script>
</body>
</html>
